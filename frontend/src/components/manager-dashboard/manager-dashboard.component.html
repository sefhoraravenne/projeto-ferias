<div class="min-h-screen bg-black text-white">
  <nav class="bg-gray-900 shadow-lg">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <app-logo></app-logo>
        <button (click)="logout()" class="px-4 py-2 bg-[#E50914] text-white rounded-lg hover:bg-red-700 transition duration-300">
          Sair
        </button>
      </div>
    </div>
  </nav>

  <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
    <header class="mb-8">
      @if(currentUser()){
        <div class="flex items-center gap-4">
          <div class="relative group">
            @if (avatarUrl()) {
              <img [src]="avatarUrl()" alt="Avatar" class="w-16 h-16 rounded-full object-cover border-2 border-gray-700">
            } @else {
              <div class="w-16 h-16 rounded-full bg-gray-700 flex items-center justify-center text-gray-400 text-2xl font-semibold border-2 border-gray-600">
                {{ currentUser()?.nome?.charAt(0).toUpperCase() }}
              </div>
            }
            <button 
              (click)="avatarInputGestor.click()"
              class="absolute inset-0 bg-black/50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center cursor-pointer"
              title="Editar avatar"
            >
              <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
              </svg>
            </button>
            <input 
              #avatarInputGestor
              type="file" 
              accept="image/*" 
              (change)="onAvatarFileSelected($event)"
              class="hidden"
            >
          </div>
          <div>
            <h1 class="text-3xl font-bold">Olá, {{ currentUser()?.nome }}</h1>
            <p class="text-gray-400 mt-1">Gerencie sua equipe e as solicitações de férias.</p>
          </div>
        </div>
      }
    </header>

    <div class="bg-gray-800 rounded-2xl shadow-lg p-6">
      <h2 class="text-2xl font-semibold mb-6">Minha Equipe</h2>
      
      @if (teamMembers().length > 0) {
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          @for (member of teamMembers(); track member.id) {
            <div class="bg-gray-900 rounded-xl p-6 flex flex-col justify-between transition duration-300 hover:shadow-red-500/20 hover:shadow-lg">
              <div>
                <h3 class="text-xl font-bold text-white">{{ member.nome }}</h3>
                <p class="text-gray-400">{{ member.cargo }}</p>
                <div class="mt-4 space-y-2 text-sm">
                  <p><span class="font-semibold text-gray-300">Setor:</span> {{ member.setor }}</p>
                  <p><span class="font-semibold text-gray-300">Salário:</span> {{ member.salario | currency:'BRL' }}</p>
                </div>

                <div class="mt-4 pt-4 border-t border-gray-700">
                  <h4 class="font-semibold text-gray-300 text-sm mb-2">Status das Férias</h4>
                  @if (member.solicitacaoFerias) {
                    @switch (member.solicitacaoFerias.status) {
                      @case ('Pendente') {
                        <div class="flex items-center space-x-2">
                          <span class="px-3 py-1 text-xs font-semibold text-yellow-800 bg-yellow-200 rounded-full">Pendente</span>
                          <span class="text-gray-400 text-xs"> (Início em {{ member.solicitacaoFerias.dataInicio | date:'dd/MM/yyyy' }})</span>
                        </div>
                      }
                      @case ('Aprovado') {
                        <div class="flex items-center space-x-2">
                          <span class="px-3 py-1 text-xs font-semibold text-green-800 bg-green-200 rounded-full">Aprovado</span>
                           <span class="text-gray-400 text-xs"> (Início em {{ member.solicitacaoFerias.dataInicio | date:'dd/MM/yyyy' }})</span>
                        </div>
                      }
                      @case ('Reprovado') {
                        <div>
                          <div class="flex items-center space-x-2 mb-1">
                            <span class="px-3 py-1 text-xs font-semibold text-red-800 bg-red-200 rounded-full">Reprovado</span>
                          </div>
                          @if(member.solicitacaoFerias.observacaoReprovacao) {
                            <p class="text-red-400 text-xs italic">"{{ member.solicitacaoFerias.observacaoReprovacao }}"</p>
                          }
                        </div>
                      }
                    }
                  } @else {
                    <p class="text-gray-500 text-sm">Nenhuma solicitação recente.</p>
                  }
                </div>
              </div>
              <button (click)="requestVacation(member.id)" class="mt-6 w-full py-2 px-4 bg-[#E50914] text-white rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-gray-900 transition duration-300">
                Solicitar Férias
              </button>
            </div>
          }
        </div>
      } @else {
        <div class="text-center py-10">
            <p class="text-gray-400">Nenhum colaborador na sua equipe.</p>
        </div>
      }
    </div>
  </main>

  <!-- Modal Avatar -->
  @if (showAvatarModal()) {
    <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
      <div class="bg-gray-800 rounded-2xl shadow-lg w-full max-w-md p-8">
        <h2 class="text-2xl font-bold mb-6">Alterar Avatar</h2>
        @if (avatarFile) {
          <div class="mb-4">
            <img [src]="getAvatarPreview()" alt="Preview" class="w-32 h-32 rounded-full mx-auto object-cover border-2 border-gray-600">
          </div>
        }
        <div class="flex justify-end space-x-4 pt-4">
          <button type="button" (click)="showAvatarModal.set(false); avatarFile = null" class="px-6 py-2 bg-gray-600 rounded-lg hover:bg-gray-500 transition">Cancelar</button>
          <button type="button" (click)="uploadAvatar()" [disabled]="!avatarFile || isUploadingAvatar()" class="px-6 py-2 bg-[#E50914] rounded-lg hover:bg-red-700 disabled:bg-red-900 disabled:cursor-not-allowed transition">
            @if (isUploadingAvatar()) {
              Enviando...
            } @else {
              Confirmar
            }
          </button>
        </div>
      </div>
    </div>
  }
</div>